<!--#include file="/common/header_detail.html" -->
<style>
.edit_group_box{
	margin:0px;
	padding: 5px 8px;
	background:#FFFFFF;
	border-left: 1px solid #AEAEAE;
	border-top: 1px solid #B1B1B1;
	border-right: 1px solid #C6E1CC;
	border-bottom: 1px solid #C6E1CC;
	box-shadow: inset 1px 0px 1px #CCCCCC,inset 0px 1px 1px #D2D2D2,inset -1px -1px 1px #F2F2F2, 1px 1px 1px #C3E0CA, -1px -1px 0px #CAE5D0;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;

}
.edit_group_box>ul>li{
	display:inline-block;
	line-height:150%;
	margin-right:5px;
}
</style>
<script src="/resources/js/md5.js"></script>
<!-- <form action="/privilege/admin_add.do" method="post" name="edit_from" id="frm" onsubmit="return submit_form(this)">
	<input name="act" type="hidden" value="save"/>
	<input name="admin_password_hash" type="hidden" value=""/>
	
	<div id="step_panel_0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" class="edit_table">
	<tr>
		<td width="120" align="right" class="title">*登录名：</td>
		<td>
<input name="admin_loginname" v_rule='{"model":"username2", "blen":"4,20","def_check_fun":"check_loginname","msg_fail":"输入错误，请输入4-20位英文字母","msg_ok":"输入正确"}' type="text" value="${admin_loginname}" size="48" maxlength="20" style="width:300px"/>

		</td>
	</tr>

	<tr>
		<td width="120" align="right" class="title">*密码：</td>
		<td>
	<input name="admin_password" v_rule='{"model":"password", "blen":"4,16","msg_fail":"输入错误，请输入4-16位字母数字组合","msg_ok":"输入正确"}' type="password" size="48" maxlength="16" style="width:300px"/>
</td>
	</tr>
	<tr>
		<td width="120" align="right" class="title">*重复密码：</td>
		<td><input name="admin_password2" v_rule='{"model":"repeat","to":"admin_password","msg_fail":"两次输入密码不致","msg_ok":"输入正确","msg":"重复输入密码"}' type="password"  size="48" maxlength="16" style="width:300px"/></td>
	</tr>

	<tr>
		<td align="right" class="title">类型：</td>
		<td>
			<select name="admin_type" style="width:300px">
for(row : adminTypes)
<option value="${row[key]}" if(intval(admin_type)==intval(row["key"]))selectedend>${row[val]}</option>
end
			</select> 
		</td>
	</tr>
	<tr>
		<td align="right" class="title">状态：</td>
		<td>
			<select name="admin_status" style="width:300px">
				<option value="1" if(admin_status==1)selectedend>启用</option>
				<option value="0" if(admin_status==0)selectedend>禁用</option>
			</select> 
		</td>
	</tr>
	<tr>
		<td width="120" align="right" class="title">*姓名：</td>
		<td><input name="admin_realname" v_rule='{"model":"text_cn_en", "blen":"2,40", "msg_fail":"输入错误，请输入2到40个中英文字符","msg_ok":"输入正确"}' type="text" value="${admin_realname}" size="48" maxlength="40" style="width:300px"/></td>
	</tr>
	<tr>
		<td width="120" align="right" class="title">所属部门：</td>
		<td><input name="admin_department" v_rule='{"model":"text_cn_en", "blen":"0,40", "msg_fail":"输入错误，请输入2到40个中英文字符","msg_ok":"输入正确"}' type="text" value="${admin_department}" size="48" maxlength="40" style="width:300px"/></td>
	</tr>
	<tr>
		<td width="120" align="right" class="title">联系电话：</td>
		<td><input name="admin_tel" v_rule='{"model":"tel", "blen":"0,20", "msg_fail":"输入错误，请输入电话号码格式，最多20个字符","msg_ok":"输入正确"}' type="text" value="${admin_tel}" size="48" maxlength="20" style="width:300px"/></td>
	</tr>
	<tr>
		<td width="120" align="right" class="title">手机号码：</td>
		<td><input name="admin_mobile" v_rule='{"model":"mobile", "blen":"0,20", "msg_fail":"输入错误，请输入手机号码格式，最多20个字符","msg_ok":"输入正确"}' type="text" value="${admin_mobile}" size="48" maxlength="20" style="width:300px"/></td>
	</tr>
	<tr>
		<td width="120" align="right" class="title">email地址：</td>
		<td><input name="admin_email" v_rule='{"model":"email", "blen":"0,50", "msg_fail":"输入错误，请输入邮箱格式，最多50个字符","msg_ok":"输入正确"}' type="text" value="${admin_email}" size="48" maxlength="50" style="width:300px"/></td>
	</tr>
	<tr>
		<td width="120" align="right" class="title">性别：</td>
		<td>
			<select name="admin_sex" style="width:300px">
				<option value="1" if(admin_sex==1)selectedend>男</option>
				<option value="2" if(admin_sex==2)selectedend>女</option>
			</select> 
		</td>
	</tr>

</table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0" class="edit_table">
    	<tr>
		<td width="120" align="right"></td>
		<td>
            <input type="button" value="下一步" id="btn_next_0" />
            <input type="button" value="返回" id="btn_back_0"  />
	</td></tr>
	</table>
</div>
<div id="step_panel_1" style="display:none;">
<div class="box_space" style="height:10px;"></div>
<table width="100%" border="0" cellpadding="0" cellspacing="0" class="edit_table">
	<tr>
		<td width="120" align="right" class="title">操作：</td>
		<td><a href="#" id="btn_role_ids_sel_all" class="link_green">全部选择</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#" id="btn_role_ids_dsel_all" class="link_green">取消选择</a></td>
	</tr>
	<tr>
		<td align="right" valign="top" class="title">分配角色：</td>
		<td>
		<div class="edit_group_box" style="width:460px">
<ul>
for(row : roleList)
<li><input type="checkbox" name="role_ids" id="role_ids_${row.role_id}" value="${row.role_id}"
if(row.relation_admin_id&&row.relation_admin_id>0)
checked
end
/><label for="role_ids_${row.role_id}">${row.role_name}</label></li>
end
</ul>
		</div>
		</td>
	</tr>
</table>

	<table width="100%" border="0" cellpadding="0" cellspacing="0" class="edit_table">
    	<tr>
		<td width="120" align="right"></td>
		<td>
            <input type="button" value="确定" id="btn_next_1" />
            <input type="button" value="返回" id="btn_back_1"  />
	</td></tr>
	</table>
</div>
</form> -->


<form action="/privilege/admin_add.do" method="post" class="form-horizontal" name="edit_from" role="frm" id="frm" onsubmit="return submit_form(this)">
<input name="act" type="hidden" value="save"/>
<input name="admin_password_hash" type="hidden" value=""/>
<div id="body1">
<div class="row">
 <div class="col-lg-12">
	<div class="ibox-content" >
		
		<div class="form-group">
			<label class="col-sm-2 control-label">*登录名：</label>
	      <div class="col-sm-5">
	          <input name="admin_loginname" id="admin_loginname" type="text"  class="form-control" />
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	  
	    <div class="form-group">
	       <label class="col-sm-2 control-label">*密码：</label>
	       <div class="col-sm-5">
				<input name="admin_password"  type="password" id="admin_password" class="form-control" />
	       </div>
	       <div class="col-sm-5"></div>
	    </div>
	    
	    <div class="form-group">
	       <label class="col-sm-2 control-label">*重复密码：</label>
	       <div class="col-sm-5">
	       		<input name="admin_password2"  type="password" id="admin_password2" class="form-control" />
	       </div>
	       <div class="col-sm-5"></div>
	    </div>  
	     
	     <div class="form-group">
			<label class="col-sm-2 control-label">类型：</label>
	      <div class="col-sm-5">
	          <select name="admin_type" class="form-control">
				<!-- for(row : adminTypes) -->
				<option value="${row[key]}" <!-- if(intval(admin_type)==intval(row["key"])) -->selected<!-- end -->>${row[val]}</option>
				<!-- end -->
			</select> 
	      </div>	
	      <div class="col-sm-5"></div>
	   </div>

	   
	   <div class="form-group">
			<label class="col-sm-2 control-label">状态：</label>
	      <div class="col-sm-5">
	          <select name="admin_status" class="form-control">
				<option value="1" <!-- if(admin_status==1) -->selected<!-- end -->>启用</option>
				<option value="0" <!-- if(admin_status==0) -->selected<!-- end -->>禁用</option>
			</select> 
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	   
	   <div class="form-group">
			<label class="col-sm-2 control-label">*姓名：</label>
	      <div class="col-sm-5">
	          <input name="admin_realname"  type="text"  class="form-control" />
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	   
	   <div class="form-group">
			<label class="col-sm-2 control-label">所属部门：</label>
	      <div class="col-sm-5">
	          <input name="admin_department"  type="text" class="form-control" />
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	   
	   <div class="form-group">
			<label class="col-sm-2 control-label">联系电话：</label>
	      <div class="col-sm-5">
	          <input name="admin_tel"  type="text"  class="form-control" />
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	   
	   <div class="form-group">
			<label class="col-sm-2 control-label">手机号码：</label>
	      <div class="col-sm-5">
	         <input name="admin_mobile"  type="text"  class="form-control" />
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	   
	   <div class="form-group">
			<label class="col-sm-2 control-label">email地址：</label>
	      <div class="col-sm-5">
	         <input name="admin_email"  type="text"  class="form-control" />
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	   
	   <div class="form-group">
			<label class="col-sm-2 control-label">性别：</label>
	      <div class="col-sm-5">
	         <select name="admin_sex" class="form-control">
				<option value="1" <!-- if(admin_sex==1) -->selected<!-- end -->>男</option>
				<option value="2" <!-- if(admin_sex==2) -->selected<!-- end -->>女</option>
			</select> 
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	   
	</div>
</div>
</div>
<div style="height:71px">
</div>

<div class="modal-footer">
	<button class="btn btn-primary" id="btn_next_0" type="button" >下一步</button>
	<button data-dismiss="modal" class="btn btn-white" type="button">关闭</button>
</div>

</div>


<div id="body2" style="display:none;">
<div class="row">
 <div class="col-lg-12">
	<div class="ibox-content" style="height:400px;">
		
		<div class="form-group">
			<label class="col-sm-2 control-label">操作：</label>
	      <div class="col-sm-5">
	          <a href="#" id="btn_role_ids_sel_all" class="link_green">全部选择</a>&nbsp;&nbsp;&nbsp;&nbsp;
	          <a href="#" id="btn_role_ids_dsel_all" class="link_green">取消选择</a>
	      </div>
	      <div class="col-sm-5"></div>
	   </div>
	  
	    <div class="form-group">
	       <label class="col-sm-2 control-label">分配角色：</label>
	       <div class="col-sm-5">
				<div class="edit_group_box" style="width:460px">
					<ul id="roleList">
					<!-- for(row : roleList) -->
					<li><input type="checkbox" name="role_ids" id="role_ids_${row.role_id}" value="${row.role_id}"
					<!-- if(row.relation_admin_id&&row.relation_admin_id>0) -->
					checked
					<!-- end -->
					/><label for="role_ids_${row.role_id}">${row.role_name}</label></li>
					<!-- end -->
					</ul>
			</div>
	       </div>
	       <div class="col-sm-5"></div>
	    </div>       
	</div>
</div>
</div>

<div style="height:71px">
</div>

<div class="modal-footer">
	<button class="btn btn-primary" id="btn_next_1" type="button" >保存</button>
	<button class="btn btn-white" id="btn_back_1" type="button">返回</button>
</div>

</div>

</form>





<script>
$(document).ready(function(){
			
		
		$.post("/privilege/getRoleListByLevel.do",
			function(data){
				$("#roleList").empty();
	         	for(var i=0;i<data.length;i++){
	         		var s="";
	         		if(data[i].relation_admin_id&&data[i].relation_admin_id>0){
	         			s="<li><input type='checkbox' name='role_ids' id='role_ids_"+data[i].role_id+"' value='"+data[i].role_id+"' checked><label for='role_ids_"+data[i].role_id+"'>"+data[i].role_name+"</label></li>";
	         		}
	         		else{
	         			s="<li><input type='checkbox' name='role_ids' id='role_ids_"+data[i].role_id+"' value='"+data[i].role_id+"'><label for='role_ids_"+data[i].role_id+"'>"+data[i].role_name+"</label></li>";
	         		}
	         		$("#roleList").append(s);
	         	}
	    	}, "json");

	
	
	
	


 // parent.update_ifrmae_height('800');
  $(".slimScrollDiv").css("height","500px");
  $("#body").css("height","500px");
  $("#body2 .col-sm-5").css("margin-top","6px");
	//$("input[name=role_ids]").last().attr('v_rule', '{"model":"checkbox", "area":"1", "msg_fail":"请选择角色"}');
 jQuery.validator.addMethod("isMobile", function(value, element) {
  var length = value.length;
  var mobile = /^(((13[0-9]{1})|(15[0-9]{1}))+\d{8})$/;
  return this.optional(element) || (length == 11 && mobile.test(value));
 }, "请正确填写您的手机号码");

 jQuery.validator.addMethod("isphone", function(value, element) {
  var length = value.length;
  var phone = /(^(\d{3,4}-)?\d{6,8}$)|(^(\d{3,4}-)?\d{6,8}(-\d{1,5})?$)|(\d{11})/;
  return this.optional(element) || (phone.test(value));
 }, "请填写正确的电话号码");
 
$("#frm").validate({
        rules: {
            admin_loginname: {
                required: true,
                rangelength:[4,20]
				/*,
                remote:{                                          //验证用户名是否存在
	               type:"POST",
	               url:"/privilege/admin_check.do",            
	               data:{
	                 act:"loginname",
	                 admin_loginname:function(){return $("#admin_loginname").val();},
	                 admin_level:function(){return $("#admin_level").val();},
	                 admin_id:function(){return "${admin_id}";}
	               } 
                } */
            },
            /*admin_level:{
            	remote:{                                          //验证用户名是否存在
	               type:"POST",
	               url:"/privilege/admin_check.do",            
	               data:{
	                 act:"loginname",
	                 admin_loginname:function(){return $("#admin_loginname").val();},
	                 admin_level:function(){return $("#admin_level").val();},
	                 admin_id:function(){return "${admin_id}";}
	               } 
                },
                onfocusout: false 
            },*/
            admin_password: {
                required: true,
                rangelength:[4,16]
            },
            admin_password2: {
                required: true,
                equalTo:"#admin_password"
            },
            admin_realname: {
                required: true,
                rangelength:[2,40]
            },
            admin_department: {
                rangelength:[2,40]
            },
            admin_tel: {
            	isphone:true,
                maxlength:20
            },
            admin_mobile: {
            	isMobile:true,
                maxlength:20
            },
            admin_email: {
            	email:true,
                maxlength:50
            }
            
        },
        messages: {
		      //  admin_level:{
		       // 	remote: "登录名在该级别已存在"
				//},
                admin_loginname: {
                    required: "请输入登录名",
                    rangelength: "请输入{0}-{1}个中英文字符"
                   // remote: "登录名在该级别已存在"
                },
                admin_password: {
                    required: "请输入密码",
                    rangelength: "请输入{0}-{1}个中英文字符"
                },
                admin_password2: {
	                required: "请再次输入密码",
	                equalTo: "两次输入的密码不一致"
            	},
            	admin_realname: {
	                required: "请输入姓名",
	                rangelength: "请输入{0}-{1}个中英文字符"
	            },
	            admin_department: {
	                rangelength: "请输入{0}-{1}个中英文字符"
	            },
	            admin_tel: {
	            	isphone:"请输入正确的联系电话",
	             	maxlength:"不能超过20个字符"
	            },
	            admin_mobile: {
	            	isMobile:"请输入正确的手机号",
	                maxlength:"不能超过20个字符"
	            },
	            admin_email: {
	            	email:"请输入正确的电子邮箱",
	                maxlength:"不能超过50个字符",
	            }
            },
           	errorPlacement: function(error, element) {
			    if (element[0].id=="admin_level")
			        error.appendTo($("#admin_loginname").parent());
			    else
			        error.appendTo(element.parent());
			} 
    });

	$("#btn_back_0").click(function (event){
		event.preventDefault();
		parent.$('#myModal').modal('hide');
	});
	$("#btn_next_0").click(function (event){
		$("#frm").validate();
		var a=$("#frm").validate().form();
		if(a){
			
			$.ajax({
				type:"post",
				url:"/privilege/admin_check.do",
				data:{admin_loginname:$("#admin_loginname").val(), act:"loginname",},
				dataType:"json",
				success:function(data){
					if(data==true){
						$("#body1").hide();
						$("#body2").show();
					}
					else{
						layer.alert("用户名已存在");
					}
				}
		});
		
		
			
			//parent.update_ifrmae_height('400');
		}
	});
	
	$("#btn_back_1").click(function (event){
		$("#body1").show();
		$("#body2").hide();
		//parent.update_ifrmae_height('640');
	});
	$("#btn_next_1").click(function (event){
		$("#frm").submit();
	});
	$("#btn_role_ids_sel_all").click(function (event){
		event.preventDefault();
		$("input[name=role_ids]").each(function (){
			this.checked=true;
		}).change();
	});

	$("#btn_role_ids_dsel_all").click(function (event){
		event.preventDefault();
		$("input[name=role_ids]").each(function (){
			this.checked=false;
		}).change();
	});
	
});
function submit_form(frm){
	var frm = $(frm);
	//验证
	
	setTimeout(function(){
	    layer.load("请稍候......", 10);
	}, 0);
	
	if(frm.find("input[name=admin_password]").length>0){
		frm.find("input[name=admin_password_hash]").val(hex_md5(frm.find("input[name=admin_password]").val()));
	}
	var post_data = frm.serialize();
	post_data = post_data.replace(/[&]*admin_password[\d]*=[\d\w]*/ig,"");
	

	$.post(frm.attr("action"), post_data, function (data){
		layer.closeAll('loading');
		if(data && data.result == 1){
			layer.alert(data.message,1 ,function (index){
				layer.close(index);
				parent.$('#myModal').modal('hide');
				parent.page_reload();
			});
			return;
		}else if(data){
			layer.alert(data.message,8,function(index){
				layer.close(index);
			});
			return;
		}
		layer.alert('操作失败');
		
	}, "json");
	return false;
}

function check_loginname(inp, fn){
	$.post("/privilege/admin_check.do?_t="+getTime(), { "act": "loginname", "admin_loginname": inp.value, "admin_id":"${admin_id}" },
		function(data){
			if(data.result == 1){
				fn(true, data.message);
			}else{
				fn(false, data.message);
			}
		}, "json");

}
</script>
<!--#include file="/common/footer_detail.html" -->